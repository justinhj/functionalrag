<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <title>Hacker News API Part 2</title>
  <meta name="description" content="Previous post: Hacker News API part 1">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4003/2017/07/29/hacker-news-api-2.html">
  <link rel="alternate" type="application/rss+xml" title="Functional[Justin]" href="http://localhost:4003/feed.xml">
</head>


  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YDJ0HSM9M6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-YDJ0HSM9M6');
  </script>

  <body>

    <header class="site-header">
  
    <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-3">
	<h5><a class="site-title" href="/">Functional[Justin]</a></h5>
      </div>
    </div>

    <div class="footer-col-wrapper">
      
      <div class="footer-col footer-col-1">
        <p>
          <img class="circle" width="110px" src="/images/justinnew.png"/></p>

      </div>
      
      <div class="footer-col footer-col-2">
        <p>Justin is a British/Canadian software engineer at Treasure Data, functional programming, polyglot, Neovim and Emacs. </p>
      </div>
      
      <div class="footer-col footer-col-3">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/justinhj"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">justinhj</span></a>

          </li>
          
	  
	  <li>
	    <a href="mailto:justinhj+blog@gmail.com">
	      <span class="icon">
		<img src="/images/email.png"/>
	      </span>
	      <span class="username">
		justinhj@gmail.com
	      </span>
	    </a>
	  </li>

          <li>
            <a href="https://gitter.im/justinhj">
            <span class="icon">
              <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 98.7 16.3" data-v-44ebcb1a=""><g><path d="M20.9,0.3h2.6v15.8h-2.6V0.3z"></path> <path d="M34.8,2.9h-4V0.3h11.8v2.6h-5.2v13.2h-2.6V2.9z"></path> <path d="M51.9,2.9h-4V0.3h11.8v2.6h-5.2v13.2h-2.6V2.9z"></path> <path d="M66.4,0.3h11.8v2.6H69v3.9h7.9v2.6H69v4h9.2v2.6H66.4V0.3z"></path> <path d="M98.7,16.1l-4.2-5.9c1.7-0.9,2.8-2.5,2.8-4.6c0-3.1-2.5-5.3-5.7-5.3l-6.2,0v15.8h2.6l0-5.3
    c0,0,3.6,0,3.6,0l3.8,5.3H98.7z M88.1,8.2l0-5.3l3.5,0c1.7,0,3,1,3,2.6c0,1.7-1.4,2.6-3,2.6L88.1,8.2z"></path> <path d="M7.9,7.1v2.6l3.9,0c0,0,0,1.4,0,2.3c-0.1,0.2-0.4,1.8-3.8,1.8c-0.2,0-0.3,0-0.5,0
    c-0.1,0-0.2,0-0.2,0c-0.1,0-0.2,0-0.2,0c-0.1,0-0.2-0.1-0.3-0.1c-0.1,0-0.1,0-0.2-0.1c0,0-0.1,0-0.1,0c-2.1-0.7-3.5-2.8-3.5-5.3
    l0,0v0v0c0-0.3,0-0.5,0.1-0.8C3.3,4.7,5.4,2.5,8,2.5c0.9,0,2.5,0.3,3.6,1.5l1.5-2.2c0,0-1.3-1.9-5-1.9C3.7,0,0.4,3.3,0,7.3
    c0,0.3,0,0.6,0,0.8l0,0l0,0c0,4.3,3.2,7.9,7.7,8.1c0.2,0,0.3,0,0.5,0c0,0,0.1,0,0.1,0c0.3,0,0.5,0,0.7,0c0.1,0,0.2,0,0.3,0
    c0.2,0,0.3,0,0.5-0.1c2.7-0.1,4.7-2.3,4.7-3.4c0-5,0-5.7,0-5.7H7.9z"></path></g></svg>
            </span>
            <span class="username">
              justinhj
            </span>
</a>
          </li>
	  <li>
	    <a href="https://www.linkedin.com/in/justinheyesjones">
	      <span class="icon">
		<img src="/images/linkedin.png"/>
	      </span>
	      <span class="username">
		LinkedIn
	      </span>
	    </a>
	  </li>

	  
          <li>
            <a href="https://twitter.com/justinhj"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">justinhj</span></a>

          </li>
          

	  
        </ul>
      </div>
      
    </div>

    <div class="my-links">
      <span class="page-link">
      	<a href="/index.html">Posts by Date</a>
       </span>

      <span class="page-link">
      	<a href="/topposts.html">Popular Posts</a>
      </span>

      <span class="page-link">
      	<a href="https://www.youtube.com/c/FunctionalJustin">YouTube channel</a>
       </span>

      <span class="page-link">
      	<a href="/talks.html">Speaking Events</a>
       </span>

      <span class="page-link">
      	<a href="/privacy.html">Privacy</a>
      </span>

      </div>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        

  

  <!-- Iterate over the tags in this post -->
  



<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Hacker News API Part 2</h1>
    <p class="post-meta"><time datetime="2017-07-29T17:00:00-07:00" itemprop="datePublished">Jul 29, 2017</time></p>
    <div class="post-meta">
      
        
        
        
        
        
        More posts about
    
      <i class="fa fa-tags"></i>
    
  
        <a href="/tag/scala/">
        Scala</a>
        
          ,
        
      
        <a href="/tag/functional-programming/">
        Functional Programming</a>
        
          ,
        
      
        <a href="/tag/hacker-news-api/">
        Hacker News Api</a>
        
          ,
        
      
        <a href="/tag/fetch/">
        Fetch</a>
        
          ,
        
      
        <a href="/tag/typelevel/">
        Typelevel</a>
        
          ,
        
      
        <a href="/tag/47-degs/">
        47 Degs</a>
        
      
    </div>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Previous post: <a href="/2017/07/26/hacker-news-api-1.html">Hacker News API part 1</a></p>

<p>Github project related to this post <a href="https://github.com/justinhj/hnfetch">hnfetch</a></p>

<p><strong>Note</strong>: I’ve updated this project a lot since this post but you can get the version from this post from this tagged <a href="https://github.com/justinhj/hnfetch/tree/blogpost2">release</a>.</p>

<p>In the last post I demonstrated building a program to fetch data from the Hacker News API using a combination of libraries including scalaj-http and uPickle. This time I will demonstrate a wrapper around the core functionality using the <a href="http://47deg.github.io/fetch/docs">Fetch</a> library by the cool folk at 47 Degrees.</p>

<p>Fetch is based on the Facebook’s Haskell library <a href="https://code.facebook.com/posts/302060973291128/open-sourcing-haxl-a-library-for-haskell/">Haxl</a> and is designed to reduce the amount of complexity around managing calls to data sources such as caches, databases and web api’s. In this article I will show how to turn my simple http calls to the Hacker News <a href="https://github.com/HackerNews/API">API</a> into Fetch friendly data sources. That will then enable us to take advantage of automatic caching of stories and users, management of how many concurrent calls to make as well as giving us a nice purely functional interface to the data which uses Free Monads.</p>

<p>Since their documentation already contains a very good tutorial and guide to all the features, I won’t repeat that here and encourage you to read that instead.</p>

<p>Fetch uses functional programming library Cats, so let’s bring that into the project as well as Fetch itself:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">libraryDependencies</span> <span class="o">++=</span> <span class="nc">Seq</span><span class="o">(</span>
  <span class="s">"org.typelevel"</span> <span class="o">%%</span> <span class="s">"cats"</span> <span class="o">%</span> <span class="s">"0.9.0"</span><span class="o">,</span>
  <span class="s">"com.47deg"</span> <span class="o">%%</span> <span class="s">"fetch"</span> <span class="o">%</span> <span class="s">"0.6.2"</span><span class="o">)</span></code></pre></figure>

<p>The next step in converting the Hacker News api code to Fetch is to create datasource for the user and story types.</p>

<p>As you can see in the Fetch documentation (and source) a datasource just has to say how to get one of a thing, multiple things, and some behaviour configuration: <a href="https://github.com/47deg/fetch/blob/master/shared/src/main/scala/datasource.scala">DataSource</a></p>

<p>Here’s the data sources for Hacker News items and stories.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">object</span> <span class="nc">HNDataSources</span> <span class="o">{</span>

  <span class="c1">// Some constants to control the behaviour of Fetch executions</span>
  <span class="c1">// These could be moved to a config file in a real applications</span>

  <span class="k">val</span> <span class="nv">fetchTimeout</span> <span class="k">:</span> <span class="kt">Duration</span> <span class="o">=</span> <span class="mi">10</span> <span class="n">seconds</span> <span class="c1">// max time to wait for a single fetch</span>
  <span class="k">val</span> <span class="nv">batchSize</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">8</span><span class="o">)</span> <span class="c1">// max concurrent requests of each data source</span>
  <span class="k">val</span> <span class="nv">executionType</span> <span class="k">:</span> <span class="kt">ExecutionType</span> <span class="o">=</span> <span class="nc">Sequential</span> <span class="c1">// whether to do batches concurrently or sequentially</span>

  <span class="k">import</span> <span class="nn">cats.data.NonEmptyList</span>

  <span class="k">implicit</span> <span class="k">object</span> <span class="nc">HNUserSource</span> <span class="k">extends</span> <span class="nc">DataSource</span><span class="o">[</span><span class="kt">HNUserID</span>, <span class="kt">HNUser</span><span class="o">]{</span>
    <span class="k">override</span> <span class="k">def</span> <span class="nf">name</span> <span class="k">=</span> <span class="s">"user"</span>

    <span class="k">override</span> <span class="k">def</span> <span class="nf">maxBatchSize</span> <span class="k">=</span> <span class="n">batchSize</span>
    <span class="k">override</span> <span class="k">def</span> <span class="nf">batchExecution</span> <span class="k">=</span> <span class="n">executionType</span>

    <span class="k">override</span> <span class="k">def</span> <span class="nf">fetchOne</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">HNUserID</span><span class="o">)</span><span class="k">:</span> <span class="kt">Query</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">HNUser</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>

      <span class="nv">Query</span><span class="o">.</span><span class="py">async</span><span class="o">({</span>
        <span class="o">(</span><span class="n">ok</span><span class="o">,</span> <span class="n">fail</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="nv">HNFetch</span><span class="o">.</span><span class="py">getUser</span><span class="o">(</span><span class="n">id</span><span class="o">)</span> <span class="n">onComplete</span> <span class="o">{</span>

            <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="n">futSucc</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">futSucc</span> <span class="k">match</span> <span class="o">{</span>
              <span class="k">case</span> <span class="nc">Right</span><span class="o">(</span><span class="n">item</span><span class="o">)</span> <span class="k">=&gt;</span>
                <span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"GOT Item $id"</span><span class="o">)</span>
                <span class="nf">ok</span><span class="o">(</span><span class="nc">Some</span><span class="o">(</span><span class="n">item</span><span class="o">))</span>
              <span class="k">case</span> <span class="nc">Left</span><span class="o">(</span><span class="n">err</span><span class="o">)</span> <span class="k">=&gt;</span>
                <span class="nf">ok</span><span class="o">(</span><span class="nc">None</span><span class="o">)</span>
            <span class="o">}</span>

            <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">e</span><span class="o">)</span> <span class="k">=&gt;</span>
              <span class="nf">fail</span><span class="o">(</span><span class="n">e</span><span class="o">)</span>
        <span class="o">}</span>
      <span class="o">},</span> <span class="n">fetchTimeout</span><span class="o">)</span>

    <span class="o">}</span>

    <span class="c1">// If the data source supports multiple queries (the HN API does not) you can implement it here</span>
    <span class="c1">// otherwise you can just tell it to use the single one using this built in function...</span>
    <span class="k">override</span> <span class="k">def</span> <span class="nf">fetchMany</span><span class="o">(</span><span class="n">ids</span><span class="k">:</span> <span class="kt">NonEmptyList</span><span class="o">[</span><span class="kt">HNUserID</span><span class="o">])</span><span class="k">:</span> <span class="kt">Query</span><span class="o">[</span><span class="kt">Map</span><span class="o">[</span><span class="kt">HNUserID</span>, <span class="kt">HNUser</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
      <span class="nf">batchingNotSupported</span><span class="o">(</span><span class="n">ids</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="k">implicit</span> <span class="k">object</span> <span class="nc">HNItemSource</span> <span class="k">extends</span> <span class="nc">DataSource</span><span class="o">[</span><span class="kt">HNItemID</span>, <span class="kt">HNItem</span><span class="o">]{</span>
    <span class="k">override</span> <span class="k">def</span> <span class="nf">name</span> <span class="k">=</span> <span class="s">"item"</span>

    <span class="k">override</span> <span class="k">def</span> <span class="nf">maxBatchSize</span> <span class="k">=</span> <span class="n">batchSize</span>
    <span class="k">override</span> <span class="k">def</span> <span class="nf">batchExecution</span> <span class="k">=</span> <span class="n">executionType</span>

    <span class="k">override</span> <span class="k">def</span> <span class="nf">fetchOne</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">HNItemID</span><span class="o">)</span><span class="k">:</span> <span class="kt">Query</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">HNItem</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
      <span class="nv">Query</span><span class="o">.</span><span class="py">async</span><span class="o">({</span>
        <span class="o">(</span><span class="n">ok</span><span class="o">,</span> <span class="n">fail</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"GET Item $id"</span><span class="o">)</span>
          <span class="nv">HNFetch</span><span class="o">.</span><span class="py">getItem</span><span class="o">(</span><span class="n">id</span><span class="o">)</span> <span class="n">onComplete</span> <span class="o">{</span>

            <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="n">futSucc</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">futSucc</span> <span class="k">match</span> <span class="o">{</span>
              <span class="k">case</span> <span class="nc">Right</span><span class="o">(</span><span class="n">item</span><span class="o">)</span> <span class="k">=&gt;</span>
                <span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"GOT Item $id"</span><span class="o">)</span>
                <span class="nf">ok</span><span class="o">(</span><span class="nc">Some</span><span class="o">(</span><span class="n">item</span><span class="o">))</span>
              <span class="k">case</span> <span class="nc">Left</span><span class="o">(</span><span class="n">err</span><span class="o">)</span> <span class="k">=&gt;</span>
                <span class="nf">ok</span><span class="o">(</span><span class="nc">None</span><span class="o">)</span>
            <span class="o">}</span>

            <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">e</span><span class="o">)</span> <span class="k">=&gt;</span>
              <span class="nf">fail</span><span class="o">(</span><span class="n">e</span><span class="o">)</span>
          <span class="o">}</span>
      <span class="o">},</span> <span class="n">fetchTimeout</span><span class="o">)</span>

    <span class="c1">// If the data source supports multiple queries (the HN API does not) you can implement it here</span>
    <span class="c1">// otherwise you can just tell it to use the single one using this built in function...</span>
    <span class="k">override</span> <span class="k">def</span> <span class="nf">fetchMany</span><span class="o">(</span><span class="n">ids</span><span class="k">:</span> <span class="kt">NonEmptyList</span><span class="o">[</span><span class="kt">HNItemID</span><span class="o">])</span><span class="k">:</span> <span class="kt">Query</span><span class="o">[</span><span class="kt">Map</span><span class="o">[</span><span class="kt">HNItemID</span>, <span class="kt">HNItem</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
      <span class="nf">batchingNotSupported</span><span class="o">(</span><span class="n">ids</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="nf">getUser</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">HNUserID</span><span class="o">)</span><span class="k">:</span> <span class="kt">Fetch</span><span class="o">[</span><span class="kt">HNUser</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Fetch</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
  <span class="k">def</span> <span class="nf">getItem</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">HNItemID</span><span class="o">)</span><span class="k">:</span> <span class="kt">Fetch</span><span class="o">[</span><span class="kt">HNItem</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Fetch</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>

<span class="o">}</span></code></pre></figure>

<p>Some things to note:</p>

<ul>
  <li>You also need to make smart constructors for each datasource to create <code class="language-plaintext highlighter-rouge">Fetch[T]</code></li>
  <li>Each data source has a name to identify it. “item” and “story” in this case</li>
  <li>You can define how mant requests to make to each data source in batches, if the underlying DB or resource supports batching for example.</li>
</ul>

<p>With that underway we can now utilize the Fetch library to grab our data in various ways. The example program <a href="https://github.com/justinhj/hnfetch/blob/master/src/main/scala/examples/FrontPageWithFetch.scala">FrontPageWithFetch</a> demonstrates the runF command <code class="language-plaintext highlighter-rouge">fetchItems.runF[Future](cache.get)</code> which returns both the Fetch result and a FetchEnv. The FetchEnv includes a detailed history of the fetch operaion as well as a cache that we can pass into the next call and avoid retrieving duplicate items. Check the Fetch documentation for how to implemnent your own cache should you need specific behaviour.</p>

<p>Here’s a little video of the interactive front page terminal app showing how repeated requests to the same page do not request them from the API…</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/4BxsPPX0nxs?rel=0&amp;showinfo=0" frameborder="0" allowfullscreen=""></iframe>

<p>Fetch’s big idea is to hide complexity such as caching, rate limiting and other complexities from client code, another big advantage of such a functional approach is that you can compose queries. In this example (not in the github repo) I demonstrate grabbing a user and his submitted items in a for comprehension. Note that the call to getUser and getItems compose nicely into Fetch operations and are then executed with runA to get the result.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala">  <span class="k">def</span> <span class="nf">monadicFetch</span><span class="o">()</span> <span class="k">=</span> <span class="o">{</span>

    <span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Main thread id ${Thread.currentThread().getId}"</span><span class="o">)</span>

    <span class="k">val</span> <span class="nv">seqFetch</span> <span class="k">=</span> <span class="nf">for</span> <span class="o">(</span>
      <span class="n">user</span> <span class="k">&lt;-</span> <span class="nf">getUser</span><span class="o">(</span><span class="s">"justinhj"</span><span class="o">);</span>
      <span class="c1">//item &lt;- getItem(user.submitted(0)) // get one item</span>
      <span class="c1">//items &lt;- (user.submitted.map(getItem(_))).sequence // get multiple as a sequence</span>
      <span class="k">_</span> <span class="k">=</span>  <span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"user has ${user.submitted.size} submitted items"</span><span class="o">);</span>
      <span class="n">items</span> <span class="k">&lt;-</span> <span class="nv">user</span><span class="o">.</span><span class="py">submitted</span><span class="o">.</span><span class="py">take</span><span class="o">(</span><span class="mi">10</span><span class="o">).</span><span class="py">traverse</span><span class="o">(</span><span class="n">getItem</span><span class="o">)</span> <span class="c1">// get multiple using traverse</span>
    <span class="o">)</span> <span class="nf">yield</span> <span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">items</span><span class="o">)</span>

    <span class="nf">val</span> <span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">items</span><span class="o">)</span> <span class="k">=</span> <span class="nv">Await</span><span class="o">.</span><span class="py">result</span><span class="o">(</span><span class="nv">seqFetch</span><span class="o">.</span><span class="py">runA</span><span class="o">[</span><span class="kt">Future</span><span class="o">],</span> <span class="nv">Duration</span><span class="o">.</span><span class="py">Inf</span><span class="o">)</span>
    <span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"""I got user ${user.id} and his submissions "${items.size}""""</span><span class="o">)</span>
    <span class="nv">items</span><span class="o">.</span><span class="py">filter</span><span class="o">(</span><span class="n">i</span> <span class="k">=&gt;</span> <span class="n">i</span><span class="o">.</span><span class="n">`type`</span> <span class="o">==</span> <span class="s">"story"</span><span class="o">).</span><span class="py">foreach</span><span class="o">{</span><span class="n">i</span> <span class="k">=&gt;</span> <span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"${i.id} : ${i.`type`}"</span><span class="o">)}</span>
    
  <span class="o">}</span>
  </code></pre></figure>

<p>This has been a short and sweet introduction to Fetch. It seems like a solid library with a lot of use cases, and a good example of Free Monad’s in the wild.</p>

<p>Postscript: Thanks to a suggestion from @peterneyens I’ve update the async datasources to use onComplete rather than map/recover</p>


  </div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6582321-6', 'auto');
  ga('send', 'pageview');

</script>

</article>



      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">


  </div>

</footer>


  </body>

</html>
